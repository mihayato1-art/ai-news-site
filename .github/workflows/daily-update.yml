# 🤖 AI情報サイト 毎日自動更新システム
name: Daily AI News Auto Update

on:
  # スケジュール実行（JST時間）
  schedule:
    - cron: '0 0 * * *'    # 毎日 09:00 JST (00:00 UTC)
    - cron: '0 9 * * *'    # 毎日 18:00 JST (09:00 UTC)
  
  # 手動実行も可能
  workflow_dispatch:
    inputs:
      force_update:
        description: '強制更新モード'
        required: false
        default: 'false'
        type: boolean

env:
  NODE_VERSION: '18'
  TZ: 'Asia/Tokyo'

jobs:
  collect-and-update:
    runs-on: ubuntu-latest
    
    steps:
    # 📁 リポジトリチェックアウト
    - name: 📁 Checkout Repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0

    # 🔧 Node.js環境セットアップ
    - name: 🔧 Setup Node.js ${{ env.NODE_VERSION }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'

    # 📦 依存関係インストール
    - name: 📦 Install Dependencies
      run: |
        npm install --production
        npm list --depth=0

    # 🔍 システム情報表示
    - name: 🔍 System Information
      run: |
        echo "🕐 実行時刻: $(date '+%Y-%m-%d %H:%M:%S %Z')"
        echo "🤖 Node.js: $(node --version)"
        echo "📦 npm: $(npm --version)"
        echo "💾 ディスク使用量: $(df -h . | tail -1 | awk '{print $5}')"

    # 📰 AI最新ニュース収集
    - name: 📰 Collect Latest AI News
      env:
        NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
        GNEWS_API_KEY: ${{ secrets.GNEWS_API_KEY }}
        FORCE_UPDATE: ${{ inputs.force_update }}
      run: |
        echo "🔍 AI最新ニュース収集を開始..."
        node scripts/collect-news.js
        echo "✅ ニュース収集完了"
        
        # 収集結果の確認
        if [ -f "data/latest-news.json" ]; then
          echo "📊 収集されたニュース件数: $(cat data/latest-news.json | jq '.news | length')"
        fi<span class="cursor">█</span>
