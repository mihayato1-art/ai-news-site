# ğŸ¤– AIæƒ…å ±ã‚µã‚¤ãƒˆ æ¯æ—¥è‡ªå‹•æ›´æ–°ã‚·ã‚¹ãƒ†ãƒ 
name: Daily AI News Auto Update

on:
  # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œï¼ˆJSTæ™‚é–“ï¼‰
  schedule:
    - cron: '0 0 * * *'    # æ¯æ—¥ 09:00 JST (00:00 UTC)
    - cron: '0 9 * * *'    # æ¯æ—¥ 18:00 JST (09:00 UTC)
  
  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½
  workflow_dispatch:
    inputs:
      force_update:
        description: 'å¼·åˆ¶æ›´æ–°ãƒ¢ãƒ¼ãƒ‰'
        required: false
        default: 'false'
        type: boolean

env:
  NODE_VERSION: '18'
  TZ: 'Asia/Tokyo'

jobs:
  collect-and-update:
    runs-on: ubuntu-latest
    
    steps:
    # ğŸ“ ãƒªãƒã‚¸ãƒˆãƒªãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
    - name: ğŸ“ Checkout Repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0

    # ğŸ”§ Node.jsç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    - name: ğŸ”§ Setup Node.js ${{ env.NODE_VERSION }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'

    # ğŸ“¦ ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    - name: ğŸ“¦ Install Dependencies
      run: |
        npm install --production
        npm list --depth=0

    # ğŸ” ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±è¡¨ç¤º
    - name: ğŸ” System Information
      run: |
        echo "ğŸ• å®Ÿè¡Œæ™‚åˆ»: $(date '+%Y-%m-%d %H:%M:%S %Z')"
        echo "ğŸ¤– Node.js: $(node --version)"
        echo "ğŸ“¦ npm: $(npm --version)"
        echo "ğŸ’¾ ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡: $(df -h . | tail -1 | awk '{print $5}')"

    # ğŸ“° AIæœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹åé›†
    - name: ğŸ“° Collect Latest AI News
      env:
        NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
        GNEWS_API_KEY: ${{ secrets.GNEWS_API_KEY }}
        FORCE_UPDATE: ${{ inputs.force_update }}
      run: |
        echo "ğŸ” AIæœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹åé›†ã‚’é–‹å§‹..."
        node scripts/collect-news.js
        echo "âœ… ãƒ‹ãƒ¥ãƒ¼ã‚¹åé›†å®Œäº†"
        
        # åé›†çµæœã®ç¢ºèª
        if [ -f "data/latest-news.json" ]; then
          echo "ğŸ“Š åé›†ã•ã‚ŒãŸãƒ‹ãƒ¥ãƒ¼ã‚¹ä»¶æ•°: $(cat data/latest-news.json | jq '.news | length')"
        fi<span class="cursor">â–ˆ</span>
